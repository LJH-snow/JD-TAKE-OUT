# 📊 JD外卖统计系统功能设计

## 🏠 1. 工作台核心指标

### 1.1 五大关键指标
```javascript
const dashboardMetrics = {
  营业额: { value: "¥12,580.00", change: "+15.6%" },
  有效订单: { value: "156单", change: "+8.2%" },
  订单完成率: { value: "94.2%", change: "+2.1%" },
  平均单价: { value: "¥80.64", change: "+7.3%" },
  新增用户: { value: "28人", change: "+12.5%" }
};
```

### 1.2 实时数据更新
- 每5分钟自动刷新
- 支持手动刷新按钮
- 显示最后更新时间

## 📅 2. 时间段筛选功能

### 2.1 时间选择器
```jsx
const TimeRangeSelector = ({ onChange, active }) => {
  const ranges = [
    { key: 'yesterday', label: '昨日' },
    { key: 'last7days', label: '近7日' },
    { key: 'last30days', label: '近30日' },
    { key: 'thisMonth', label: '本月' },
    { key: 'custom', label: '自定义' }
  ];
  
  return (
    <div className="time-selector">
      {ranges.map(range => (
        <button 
          key={range.key}
          className={active === range.key ? 'active' : ''}
          onClick={() => onChange(range.key)}
        >
          {range.label}
        </button>
      ))}
    </div>
  );
};
```

### 2.2 API接口参数
```javascript
// 所有图表API都支持时间筛选
const apiCall = (endpoint, timeRange) => {
  const { startDate, endDate } = getTimeRangeData(timeRange);
  return fetch(`${endpoint}?start=${startDate}&end=${endDate}`);
};
```

## 📈 3. 销售趋势图（多时间段支持）

### 3.1 图表配置
```javascript
const salesChartOption = {
  title: { text: '销售趋势分析' },
  tooltip: {
    formatter: (params) => `
      📅 ${params[0].name}
      💰 销售额: ¥${params[0].value}
      📋 订单数: ${params[1].value}单
      👥 顾客数: ${params[2].value}人
    `
  },
  xAxis: { 
    type: 'category',
    data: chartData.map(item => item.date)
  },
  yAxis: [
    { type: 'value', name: '销售额(元)' },
    { type: 'value', name: '数量' }
  ],
  series: [
    { name: '销售额', type: 'line', yAxisIndex: 0 },
    { name: '订单数', type: 'bar', yAxisIndex: 1 },
    { name: '顾客数', type: 'line', yAxisIndex: 1 }
  ]
};
```

## 🥘 4. 热销菜品排行榜（时间筛选）

### 4.1 可筛选排行榜
```jsx
const DishRanking = () => {
  const [timeRange, setTimeRange] = useState('last7days');
  const [category, setCategory] = useState('all');
  const [sortBy, setSortBy] = useState('quantity');
  
  return (
    <div className="dish-ranking">
      <div className="controls">
        <TimeRangeSelector onChange={setTimeRange} />
        <Select value={category} onChange={setCategory}>
          <Option value="all">全部分类</Option>
          <Option value="热菜">热菜</Option>
          <Option value="凉菜">凉菜</Option>
        </Select>
        <Select value={sortBy} onChange={setSortBy}>
          <Option value="quantity">按销量</Option>
          <Option value="revenue">按销售额</Option>
        </Select>
      </div>
      <ReactECharts option={rankingOption} />
    </div>
  );
};
```

## 📥 5. 数据导出功能

### 5.1 导出格式支持
```javascript
const exportFormats = {
  excel: {
    label: 'Excel表格',
    icon: '📊',
    handler: exportToExcel
  },
  csv: {
    label: 'CSV文件', 
    icon: '📄',
    handler: exportToCSV
  },
  pdf: {
    label: 'PDF报告',
    icon: '📋', 
    handler: exportToPDF
  },
  image: {
    label: '图表图片',
    icon: '🖼️',
    handler: exportToImage
  }
};
```

### 5.2 Excel导出实现
```javascript
const exportToExcel = async (data, type, timeRange) => {
  const XLSX = await import('xlsx');
  const workbook = XLSX.utils.book_new();
  
  // 创建工作表
  const worksheet = XLSX.utils.json_to_sheet(
    data.map(item => formatDataForExcel(item, type))
  );
  
  XLSX.utils.book_append_sheet(workbook, worksheet, '数据');
  
  // 下载文件
  const fileName = `${type}_${timeRange}_${new Date().toISOString().split('T')[0]}.xlsx`;
  XLSX.writeFile(workbook, fileName);
};
```

### 5.3 导出按钮组件
```jsx
const ExportButton = ({ dataType, data, timeRange }) => {
  const [showModal, setShowModal] = useState(false);
  
  return (
    <>
      <Button 
        type="primary" 
        icon="📥"
        onClick={() => setShowModal(true)}
      >
        导出数据
      </Button>
      
      <Modal 
        visible={showModal}
        title="选择导出格式"
        onCancel={() => setShowModal(false)}
      >
        <div className="export-options">
          {Object.entries(exportFormats).map(([key, format]) => (
            <div 
              key={key}
              className="export-option"
              onClick={() => {
                format.handler(data, dataType, timeRange);
                setShowModal(false);
              }}
            >
              <span className="icon">{format.icon}</span>
              <span className="label">{format.label}</span>
            </div>
          ))}
        </div>
      </Modal>
    </>
  );
};
```

## 🔧 6. 后端API设计

### 6.1 统计接口
```go
// 工作台概览
// GET /api/v1/admin/dashboard/overview?date=2025-01-06
type DashboardData struct {
    TotalRevenue   float64 `json:"total_revenue"`
    RevenueChange  float64 `json:"revenue_change"`
    ValidOrders    int     `json:"valid_orders"`
    OrdersChange   float64 `json:"orders_change"`
    CompletionRate float64 `json:"completion_rate"`
    AveragePrice   float64 `json:"average_price"`
    NewUsers       int     `json:"new_users"`
    UpdateTime     string  `json:"update_time"`
}

// 销售趋势
// GET /api/v1/admin/stats/sales?start=2025-01-01&end=2025-01-07
type SalesData struct {
    Date      string  `json:"date"`
    Revenue   float64 `json:"revenue"`
    Orders    int     `json:"orders"`
    Customers int     `json:"customers"`
}

// 菜品排行
// GET /api/v1/admin/stats/dishes?start=2025-01-01&end=2025-01-07&category=all&sort=quantity
type DishData struct {
    Name     string  `json:"name"`
    Category string  `json:"category"`
    Quantity int     `json:"quantity"`
    Revenue  float64 `json:"revenue"`
    Price    float64 `json:"price"`
}
```

### 6.2 数据导出接口
```go
// POST /api/v1/admin/export
type ExportRequest struct {
    DataType  string `json:"data_type"`  // dashboard, sales, dishes, categories
    StartDate string `json:"start_date"`
    EndDate   string `json:"end_date"`
    Format    string `json:"format"`     // excel, csv, pdf
    Filters   map[string]interface{} `json:"filters"`
}

type ExportResponse struct {
    DownloadURL string `json:"download_url"`
    FileName    string `json:"file_name"`
    ExpiresAt   string `json:"expires_at"`
}
```

## 🎯 7. 实施优先级（2周开发）

### 第一周：
1. **工作台指标卡片**（1天）
2. **时间筛选器组件**（1天）  
3. **销售趋势图**（2天）
4. **基础数据导出**（1天）

### 第二周：
1. **菜品排行榜**（2天）
2. **分类统计图**（1天）
3. **完善导出功能**（1天）
4. **样式优化和测试**（1天）

## 📱 8. 界面预览

```
┌─────────────────────────────────────────────────────────┐
│ 🏠 工作台 | 📊 数据分析 | 📋 订单管理 | 🍽️ 菜品管理      │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ ┌─────────┬─────────┬─────────┬─────────┬─────────┐     │
│ │💰营业额  │📋有效订单│✅完成率  │💸平均价 │👥新用户 │     │
│ │¥12,580 │  156单  │ 94.2%  │ ¥80.64│  28人  │     │
│ │ +15.6% │ +8.2%  │ +2.1%  │ +7.3% │+12.5% │     │
│ └─────────┴─────────┴─────────┴─────────┴─────────┘     │
│                                                         │
│ 📅 [昨日] [近7日] [近30日] [本月] [自定义]  🔄 14:30:25  │
│                                                         │
│ ┌─────────────────────┬─────────────────────────────┐   │
│ │   📈 销售趋势图       │    🥘 热销菜品TOP10         │   │
│ │                    │                             │   │
│ │  [折线图+柱状图]     │ 1. 宫保鸡丁   156份 ¥4,368 │   │
│ │                    │ 2. 麻婆豆腐   132份 ¥2,376 │   │
│ │  📥 导出数据         │ 3. 凉拌黄瓜    98份 ¥784   │   │
│ │                    │    📥 导出数据             │   │
│ └─────────────────────┴─────────────────────────────┘   │
└─────────────────────────────────────────────────────────┘
```

这个设计完全满足你的要求：**支持多时间段查看、数据导出、工作台五大指标显示**！